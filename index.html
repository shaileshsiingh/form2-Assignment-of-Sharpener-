<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form onsubmit="saveLocalStorage(event)">
        <label>Name</label>
        <input type="text" name="username" required>
        <label>EmailId</label>
        <input type="text" name="emailId" required>
        <label>Phone</label>
        <input type="text" name="phonenumber" required>
        <button type="submit">Submit</button>
        <ul id="listofusers"></ul>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function saveLocalStorage(e){
            e.preventDefault();
            const name = e.target.username.value;
            const email = e.target.emailId.value;
            const phone = e.target.phonenumber.value;

            const obj = {
                name: name,
                email: email,
                phone: phone
            }
            // localStorage.setItem(email, JSON.stringify(obj));

            axios.post("https://crudcrud.com/api/ac5eba735cab484cb4acb8fa80ed6a35/appointmentPost", obj)
            .then((response) =>{
                showUserOnScreen(response.data)
                console.log(response);
            })
            .catch((err) => {
                document.body.innerHTML = document.body.innerHTML + "<h4>something went wrong</h4>"
            })
            // showUserOnScreen(obj);
            e.target.reset();
        }

        window.addEventListener("DOMContentLoaded",()=>{
            axios.get('https://crudcrud.com/api/ac5eba735cab484cb4acb8fa80ed6a35/appointmentPost')
  .then((response) => {
    for(var i = 0; i<=response.data.length; i++){
        showUserOnScreen(response.data[i])
    }
    console.log(response);
  })
  .catch((err) => {
   
    console.error(err);
  });

        })

        function showUserOnScreen(obj){
    let parentElement = document.getElementById('listofusers');
    parentElement.innerHTML += `<li data-email="${obj.email}">${obj.name} - ${obj.email} - ${obj.phone}  <button type="button" onclick="deleteUser('${obj.email}')">Delete</button> <button type="button" onclick="editUser('${obj.email}')">Edit</button></li>`;
}


        function deleteUser(email){
            let childElem = document.querySelector('li')
            childElem.remove();
            localStorage.removeItem(email)
        }

        function editUser(email){
    let obj = JSON.parse(localStorage.getItem(email));
    let name = obj.name;
    let phone = obj.phone;
    
    // populate form fields with user's information
    document.querySelector('input[name="username"]').value = name;
    document.querySelector('input[name="emailId"]').value = email;
    document.querySelector('input[name="phonenumber"]').value = phone;

    // remove the corresponding li element from UI
    let liElem = document.querySelector(`li[data-email="${email}"]`);
    liElem.remove();

    // remove the corresponding item from local storage
    localStorage.removeItem(email);
}

    </script>
</body>
</html>
